---
title: "Descriptive statistics"
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
bibliography: references.bib
output:
  html_document:
    css: tweaks.css
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    code_folding: show
    code_download: yes
---



```{r, globalsettings, echo=FALSE, warning=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()


colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}

```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```



---


We will use the RSiena object to describe the friendship and kudo networks, constant covariates and behavioral variables.We will do this seperately for the 5 clubs.

We cover the following:

* club characteristics
* network structure in Friendship and Kudo networks
* gender composition / segregation
* behavior: activity level (frequency and volume)
* spatial network autocorrelation: behavioral similarity in networks


----

<br>

# Preparation

Clean the working environment, set the working directory to the folder with the list object containing the RSiena objects, and load in the data.


```{r, attr.output='style="max-height: 200px;"'}
# clean the working environment 
rm (list = ls( ))

# load the object
load("clubdata_rsiena.RData")

# inspect
str(clubdata_rsiena)
```

A list of 5 lists, with each of these lists containing data of the corresponding club.




```{r packages}
#install if necessary 
if (!require("RSiena", character.only = TRUE)) {install.packages("RSiena", dependencies=TRUE)}
if (!require("igraph", character.only = TRUE)) {install.packages("igraph", dependencies=TRUE)}
if (!require("tidyverse", character.only = TRUE)) {install.packages("tidyverse", dependencies=TRUE)}
if (!require("tidyr", character.only = TRUE)) {install.packages("tidyr", dependencies=TRUE)}
if (!require("moments", character.only = TRUE)) {install.packages("moments", dependencies=TRUE)}
if (!require("dplyr", character.only = TRUE)) {install.packages("dplyr", dependencies=TRUE)}
if (!require("ggplot2", character.only = TRUE)) {install.packages("ggplot2", dependencies=TRUE)}
if (!require("forcats", character.only = TRUE)) {install.packages("forcats", dependencies=TRUE)}
if (!require("knitr", character.only = TRUE)) {install.packages("knitr", dependencies=TRUE)}
if (!require("kableExtra", character.only = TRUE)) {install.packages("kableExtra", dependencies=TRUE)}
if (!require("network", character.only = TRUE)) {install.packages("network", dependencies=TRUE)}
if (!require("sna", character.only = TRUE)) {install.packages("sna", dependencies=TRUE)}

#load packages.
library(RSiena) #RSiena models, some descriptives on network level
library(igraph) #Descriptives: dyad/triad census, degree
library(tidyverse)
library(tidyr) #for tidy data
library(moments) #for calculating statistics (e.g., kurtosis, standard error)
library(dplyr) #for data manipulation
library(ggplot2) #for data visualisation
library(forcats) #for handling categorical variables
library(knitr) #for generating tables
library(kableExtra) #for manipulating tables
library(network) #for network analysis
library(sna) #for network analysis
```


----

Now define some functions we use later on to describe our data (see [www.jochemtolsma.nl](https://www.jochemtolsma.nl/courses/complete-networks/socio6/#descriptive-statistics)).  

- fdensity: calculate density (exclude NA and structural zeros)  
- fdensityintra: calculate density within group (exclude NA and structural zeros)  
- fdensityinter: calculate density between groups (exclude NA and structural zeros)  
- fhomomat: based on ego/alter characteristics, construct dyad characteristic whether or not ego/alter are same 
- fndyads: calculate all valid dyads (no NA or structural zeros)  
- fscolnet: calculate Coleman's segregation index on the network-level  
- fMoran.i: calculate Moran's I spatial autocorrelation statistic (see [here](https://www.jochemtolsma.nl/courses/complete-networks/socio7/#morans-autocorrelation-for-outgoing-ties-rsiena-build-in-dataset))



```{r class.source = 'fold-hide'}
# density: observed relations divided by possible relations
fdensity <- function(x) {
    # x is your nomination network make sure diagonal cells are NA
    diag(x) <- NA
    # take care of RSiena structural zeros, set as missing.
    x[x == 10] <- NA
    sum(x == 1, na.rm = T)/(sum(x == 1 | x == 0, na.rm = T))
}

# calculate intragroup density
fdensityintra <- function(x, A) {
    # A is matrix indicating whether nodes in dyad have same node attributes
    diag(x) <- NA
    x[x == 10] <- NA
    diag(A) <- NA
    sum(x == 1 & A == 1, na.rm = T)/(sum((x == 1 | x == 0) & A == 1, na.rm = T))
}

# calculate intragroup density
fdensityinter <- function(x, A) {
    # A is matrix indicating whether nodes in dyad have same node attributes
    diag(x) <- NA
    x[x == 10] <- NA
    diag(A) <- NA
    sum(x == 1 & A != 1, na.rm = T)/(sum((x == 1 | x == 0) & A != 1, na.rm = T))
}

# construct dyad characteristic whether nodes are similar/homogenous
fhomomat <- function(x) {
    # x is a vector of node-covariate
    xmat <- matrix(x, nrow = length(x), ncol = length(x))
    xmatt <- t(xmat)
    xhomo <- xmat == xmatt
    return(xhomo)
}

# a function to calculate all valid dyads.
fndyads <- function(x) {
    diag(x) <- NA
    x[x == 10] <- NA
    (sum((x == 1 | x == 0), na.rm = T))
}

# a function to calculate all valid intragroupdyads.
fndyads2 <- function(x, A) {
    diag(x) <- NA
    x[x == 10] <- NA
    diag(A) <- NA
    (sum((x == 1 | x == 0) & A == 1, na.rm = T))
}


fscolnet <- function(network, ccovar) {
    # Calculate coleman on network level:
    # https://reader.elsevier.com/reader/sd/pii/S0378873314000239?token=A42F99FF6E2B750436DD2CB0DB7B1F41BDEC16052A45683C02644DAF88215A3379636B2AA197B65941D6373E9E2EE413
    
    fhomomat <- function(x) {
        xmat <- matrix(x, nrow = length(x), ncol = length(x))
        xmatt <- t(xmat)
        xhomo <- xmat == xmatt
        return(xhomo)
    }
    
    fsumintra <- function(x, A) {
        # A is matrix indicating whether nodes constituting dyad have same characteristics
        diag(x) <- NA
        x[x == 10] <- NA
        diag(A) <- NA
        sum(x == 1 & A == 1, na.rm = T)
    }
    
    # expecation w*=sum_g sum_i (ni((ng-1)/(N-1)))
    network[network == 10] <- NA
    ni <- rowSums(network, na.rm = T)
    ng <- NA
    for (i in 1:length(ccovar)) {
        ng[i] <- table(ccovar)[rownames(table(ccovar)) == ccovar[i]]
    }
    N <- length(ccovar)
    wexp <- sum(ni * ((ng - 1)/(N - 1)), na.rm = T)
    
    # wgg1 how many intragroup ties
    w <- fsumintra(network, fhomomat(ccovar))
    
    Scol_net <- ifelse(w >= wexp, (w - wexp)/(sum(ni, na.rm = T) - wexp), (w - wexp)/wexp)
    return(Scol_net)
}

fMoran.I <- function(x, weight, scaled = FALSE, na.rm = FALSE, alternative = "two.sided", rowstandardize = TRUE) {
    if (rowstandardize) {
        if (dim(weight)[1] != dim(weight)[2]) 
            stop("'weight' must be a square matrix")
        n <- length(x)
        if (dim(weight)[1] != n) 
            stop("'weight' must have as many rows as observations in 'x'")
        ei <- -1/(n - 1)
        nas <- is.na(x)
        if (any(nas)) {
            if (na.rm) {
                x <- x[!nas]
                n <- length(x)
                weight <- weight[!nas, !nas]
            } else {
                warning("'x' has missing values: maybe you wanted to set na.rm = TRUE?")
                return(list(observed = NA, expected = ei, sd = NA, p.value = NA))
            }
        }
        ROWSUM <- rowSums(weight)
        ROWSUM[ROWSUM == 0] <- 1
        weight <- weight/ROWSUM
        s <- sum(weight)
        m <- mean(x)
        y <- x - m
        cv <- sum(weight * y %o% y)
        v <- sum(y^2)
        obs <- (n/s) * (cv/v)
        if (scaled) {
            i.max <- (n/s) * (sd(rowSums(weight) * y)/sqrt(v/(n - 1)))
            obs <- obs/i.max
        }
        S1 <- 0.5 * sum((weight + t(weight))^2)
        S2 <- sum((apply(weight, 1, sum) + apply(weight, 2, sum))^2)
        s.sq <- s^2
        k <- (sum(y^4)/n)/(v/n)^2
        sdi <- sqrt((n * ((n^2 - 3 * n + 3) * S1 - n * S2 + 3 * s.sq) - k * (n * (n - 1) * S1 - 2 * n * 
            S2 + 6 * s.sq))/((n - 1) * (n - 2) * (n - 3) * s.sq) - 1/((n - 1)^2))
        alternative <- match.arg(alternative, c("two.sided", "less", "greater"))
        pv <- pnorm(obs, mean = ei, sd = sdi)
        if (alternative == "two.sided") 
            pv <- if (obs <= ei) 
                2 * pv else 2 * (1 - pv)
        if (alternative == "greater") 
            pv <- 1 - pv
        list(observed = obs, expected = ei, sd = sdi, p.value = pv)
    } else {
        if (dim(weight)[1] != dim(weight)[2]) 
            stop("'weight' must be a square matrix")
        n <- length(x)
        if (dim(weight)[1] != n) 
            stop("'weight' must have as many rows as observations in 'x'")
        ei <- -1/(n - 1)
        nas <- is.na(x)
        if (any(nas)) {
            if (na.rm) {
                x <- x[!nas]
                n <- length(x)
                weight <- weight[!nas, !nas]
            } else {
                warning("'x' has missing values: maybe you wanted to set na.rm = TRUE?")
                return(list(observed = NA, expected = ei, sd = NA, p.value = NA))
            }
        }
        # ROWSUM <- rowSums(weight) ROWSUM[ROWSUM == 0] <- 1 weight <- weight/ROWSUM
        s <- sum(weight)
        m <- mean(x)
        y <- x - m
        cv <- sum(weight * y %o% y)
        v <- sum(y^2)
        obs <- (n/s) * (cv/v)
        if (scaled) {
            i.max <- (n/s) * (sd(rowSums(weight) * y)/sqrt(v/(n - 1)))
            obs <- obs/i.max
        }
        S1 <- 0.5 * sum((weight + t(weight))^2)
        S2 <- sum((apply(weight, 1, sum) + apply(weight, 2, sum))^2)
        s.sq <- s^2
        k <- (sum(y^4)/n)/(v/n)^2
        sdi <- sqrt((n * ((n^2 - 3 * n + 3) * S1 - n * S2 + 3 * s.sq) - k * (n * (n - 1) * S1 - 2 * n * 
            S2 + 6 * s.sq))/((n - 1) * (n - 2) * (n - 3) * s.sq) - 1/((n - 1)^2))
        alternative <- match.arg(alternative, c("two.sided", "less", "greater"))
        pv <- pnorm(obs, mean = ei, sd = sdi)
        if (alternative == "two.sided") 
            pv <- if (obs <= ei) 
                2 * pv else 2 * (1 - pv)
        if (alternative == "greater") 
            pv <- 1 - pv
        list(observed = obs, expected = ei, sd = sdi, p.value = pv)
    }
    
    
}
```

----

<br>

# Print report
## {.tabset .tabset-fade} 
Make sure to check the output of the 'print01Report()' function for general data descripton (degrees, network size, etc.) and a general overview of the dataset. Output is printed in a .txt file in the directory specified.


### Club 1
```{r}
df <- clubdata_rsiena[[1]] # grab club 

print01Report(df)
```

### Club 2
```{r }
df <- clubdata_rsiena[[2]] # grab club 

print01Report(df)
```

### Club 3
```{r }
df <- clubdata_rsiena[[3]] # grab club 

print01Report(df)
```

### Club 4
```{r}
df <- clubdata_rsiena[[4]] # grab club 

print01Report(df)
```

### Club 5
```{r}
df <- clubdata_rsiena[[5]] # grab club 

print01Report(df)
```

## {-}

----

# Club characteristics

We start off with addressing some club characteristics. We show the size of the network (the number of actors) for each club and the number of active members currently (18-1-2021) on Strava, by adding to *www.strava.com/clubs/...* the original club id. 

<!--- In the future we may want to find out how many members each club has, so we can also calculate the proportion of members that is active on Strava. --> 

```{r}
netsize <- c( 
  length(clubdata_rsiena[[1]]$nodeSets$Actors), 
  length(clubdata_rsiena[[2]]$nodeSets$Actors), 
  length(clubdata_rsiena[[3]]$nodeSets$Actors), 
  length(clubdata_rsiena[[4]]$nodeSets$Actors), 
  length(clubdata_rsiena[[5]]$nodeSets$Actors)) # attrieve from the clubdata the number of actors in each network

clubsize <- c(66, 127, 373, 15, 169) # find the number of members currently on Strava

df <- data.frame( netsize = netsize, clubsize = clubsize )

print(df)
```

<br>

----

# Friendship network

We start off with describing the friendship network. Note that the friendship network is a constant dyadic covariate.

## 1. Node-level {.tabset .tabset-fade}

Let's describe the friendship-indegrees and -outdegrees of the Strava-users in each club. We take from the RSiena object the friendship network of the club in question, and turn it into an *igraph* object. Then we find the in- and outdegree of each node.

### Club 1
```{r}
df <- clubdata_rsiena[[1]] # grab club 
fnet <- df$dycCovars$friendship # take friendship network

# make a 'graph object'
G1 <- igraph::graph_from_adjacency_matrix(fnet, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of outdegree Strava friendship network")
hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of indegree Strava friendship network")
```

### Club 2
```{r}
df <- clubdata_rsiena[[2]] # grab club 
fnet <- df$dycCovars$friendship # take friendship network

# make a 'graph object'
G1 <- igraph::graph_from_adjacency_matrix(fnet, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of outdegree Strava friendship network")
hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of indegree Strava friendship network")
```

### Club 3
```{r}
df <- clubdata_rsiena[[3]] # grab club 
fnet <- df$dycCovars$friendship # take friendship network

# make a 'graph object'
G1 <- igraph::graph_from_adjacency_matrix(fnet, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of outdegree Strava friendship network")
hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of indegree Strava friendship network")
```

### Club 4
```{r }
df <- clubdata_rsiena[[4]] # grab club 
fnet <- df$dycCovars$friendship # take friendship network

# make a 'graph object'
G1 <- igraph::graph_from_adjacency_matrix(fnet, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of outdegree Strava friendship network")
hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of indegree Strava friendship network")
```

### Club 5
```{r}
df <- clubdata_rsiena[[5]] # grab club 
fnet <- df$dycCovars$friendship # take friendship network

# make a 'graph object'
G1 <- igraph::graph_from_adjacency_matrix(fnet, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of outdegree Strava friendship network")
hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of indegree Strava friendship network")
```

## {-}
In general, we see that the in- and outdegree distribution is right-skewed, suggesting that most Strava-users befriend and are befriended by relatively few club-members, while fewer users befriend and are befriended by many club-members.

<br>

## 2. Dyad-level {.tabset .tabset-fade}

Let's investigate to what extent friendship-relationships (dyads) are reciprocated or mutual. There are three types of dyad: mutual, assymetric, and non-existent. We will classify dyads with the dyad-census function, and we will investigate if we observe more mutual dyads than we would expect based on chance.


### Club 1
```{r }
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[1]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dyads to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of mutual dyads in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 2
```{r }
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[2]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dayds to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of mutual dyads in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 3
```{r}
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[3]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dayds to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of mutual dyads in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 4
```{r }
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[4]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dayds to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of mutual dyads in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 5
```{r}
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[5]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dayds to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of mutual dyads in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

## {-}
As expected, mutual dyads are way more prominent than would be expected based on chance, which is indicative of reciprocity effects in Strava-friendships among the members of clubs.   

<br>

## 3. Triad-level {.tabset .tabset-fade}

There are 16 types of triads; see @davis1967structure. They can be classified with the triad-census function. See [here](https://igraph.org/r/doc/triad_census.html) for the order in which the multiple triad classifications are counted.

Let's also calculate for each club the (global) transitivity index, which is the ratio of connected triplets (transitive triads) and potentially connected triplets (see [here](http://www.stats.ox.ac.uk/~snijders/Trans_Triads_ha.pdf)). The direction of the edges is ignored. We will then calculate the global transitivity index for random (undirected) graphs.

### Club 1
```{r}
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[1]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify triads
triadcount <- igraph::triad.census(G1)

# and print the 16 configurations
print(triadcount)

# global (or undirected) transitivity index
igraph::transitivity(G1)

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- transitivity(random_graph)
}

{hist(recip, main="global transitivity index in random graph", xlab="" )
abline(v=transitivity(G1), col="red", lwd=3)}

```

### Club 2
```{r }
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[2]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify triads
triadcount <- igraph::triad.census(G1)

# and print the 16 configurations
print(triadcount)

# global (or undirected) transitivity index
igraph::transitivity(G1)

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- transitivity(random_graph)
}

{hist(recip, main="global transitivity index in random graph", xlab="" )
abline(v=transitivity(G1), col="red", lwd=3)}

```

### Club 3
```{r}
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[3]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify triads
triadcount <- igraph::triad.census(G1)

# and print the 16 configurations
print(triadcount)

# global (or undirected) transitivity index
igraph::transitivity(G1)

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- transitivity(random_graph)
}

{hist(recip, main="global transitivity index in random graph", xlab="" )
abline(v=transitivity(G1), col="red", lwd=3)}

```

### Club 4
```{r}
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[4]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify triads
triadcount <- igraph::triad.census(G1)

# and print the 16 configurations
print(triadcount)

# global (or undirected) transitivity index
igraph::transitivity(G1)

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- transitivity(random_graph)
}

{hist(recip, main="global transitivity index in random graph", xlab="" )
abline(v=transitivity(G1), col="red", lwd=3)}

```

### Club 5
```{r}
# make igraph object for the club
G1 <- igraph::graph_from_adjacency_matrix(clubdata_rsiena[[5]]$dycCovars$friendship, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify triads
triadcount <- igraph::triad.census(G1)

# and print the 16 configurations
print(triadcount)

# global (or undirected) transitivity index
igraph::transitivity(G1)

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- transitivity(random_graph)
}

hist(recip, main="global transitivity index in random graph", xlab="" )

```

## {-}

Also transitivity is more prominent than would be expected solely based on chance. 

<br>
----

# Kudo network

Now let's describe the Kudo network, which we view as a dependent behavioral variable. 

## 1. Node-level {.tabset .tabset-fade}

Starting, again, with indegrees and outdegrees: who receives and gives Kudos? We take from the RSiena object the Kudo network for each club, subset the first wave, and turn it into an *igraph* object. 

### Club 1
```{r}
df <- clubdata_rsiena[[1]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of Kudo outdegree")

hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of Kudo indegree")
```

### Club 2
```{r}
df <- clubdata_rsiena[[2]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of Kudo outdegree")

hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of Kudo indegree")
```

### Club 3
```{r}
df <- clubdata_rsiena[[3]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of Kudo outdegree")

hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of Kudo indegree")
```

### Club 4
```{r}
df <- clubdata_rsiena[[4]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of Kudo outdegree")

hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of Kudo indegree")
```

### Club 5
```{r}
df <- clubdata_rsiena[[5]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# find in- and outdegree for each node
hist(igraph::degree(G1, mode="out"), xlab="outdegree", main="histogram of Kudo outdegree")

hist(igraph::degree(G1, mode="in"), xlab="indegree", main="histogram of Kudo indegree")
```

## {-}

We can observe the same Pareto-like-patern: some give/receive most of the Kudos given, while most give/receive few.

<br>

## 2. Dyad-level {.tabset .tabset-fade}

At the dyad-level: let's see to what extent Kudos tend to be reciprocated between actors.

### Club 1
```{r }
# make igraph object for the club, at wave 1
df <- clubdata_rsiena[[1]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dyads to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of reciprocated Kudos in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 2
```{r }
# make igraph object for the club, at wave 1
df <- clubdata_rsiena[[2]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dyads to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of reciprocated Kudos in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 3
```{r }
# make igraph object for the club, at wave 1
df <- clubdata_rsiena[[3]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dyads to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of reciprocated Kudos in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 4
```{r }
# make igraph object for the club, at wave 1
df <- clubdata_rsiena[[4]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dyads to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of reciprocated Kudos in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

### Club 5
```{r }
# make igraph object for the club, at wave 1
df <- clubdata_rsiena[[5]] # grab club 
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# make an 'igraph object'
G1 <- igraph::graph_from_adjacency_matrix(knet1, mode = "directed", weighted = NULL, diag = TRUE, add.colnames = NA, add.rownames = NA)

# classify dyads
dyadcount <- igraph::dyad.census(G1)

# add the total number of dyads to the graph
dyadcount$total <- (vcount(G1)*(vcount(G1)-1))/2
dyadcount

# compare values with a random graph of the same size with the same density
dens <- igraph::graph.density(G1)
size <- igraph::vcount(G1)
trial <- 1000
recip <- rep(NA, trial)

for ( i in 1:trial ){
  random_graph <- igraph::erdos.renyi.game(n = size, p.or.m = dens, directed = TRUE)
  recip[i] <- igraph::dyad.census(random_graph)$mut
}

{hist(recip, main="number of reciprocated Kudos in random graph", xlab="", )
abline(v=dyadcount$mut, col="red", lwd=3)}
```

## {-}

Conclusion: Kudos tend to be reciprocated, like friendships!

----


<br>

# Gender composition 
## {.tabset .tabset-fade}
Let's investigate the gender composition of the club.
We must retrieve gender from the object (note that we use the clubdata object, not the rsiena object). Then we make a categorical gender variable and plot it.

### Club 1
```{r class.source = 'fold-hide'}
df <- clubdata[[1]] # grab club 

# retrieve node-attribute gender from object
male <- df$male
female <- df$female
other <- df$other

# as factor
gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# make dataframe
df <- data.frame(
  gender = as.factor(c("Male", "Female", "Other", "Missing")),
  n = c(length(gender[gender == "Male"]), length(gender[gender == "Female"]), length(gender[gender == "Other"]), length(gender[gender == "Missing"])),
  freq = c(round(length(gender[gender=="Male"])/length(gender), digits=2), round(length(gender[gender=="Female"])/length(gender), digits=2), round(length(gender[gender=="Other"])/length(gender), digits=2), round(length(gender[gender=="Missing"])/length(gender), digits=2))
)

# plot
df %>%
  mutate(gender = fct_reorder(gender, -n)) %>%
           ggplot(aes(gender, n, fill=gender)) + 
           geom_bar(stat="identity", width=0.8) +
           geom_text(aes(label=paste0(freq,"%")), vjust=1.5, colour="white")

```

### Club 2
```{r class.source = 'fold-hide'}
df <- clubdata[[2]] # grab club 

# retrieve node-attribute gender from object
male <- df$male
female <- df$female
other <- df$other

# as factor
gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# make dataframe
df <- data.frame(
  gender = as.factor(c("Male", "Female", "Other", "Missing")),
  n = c(length(gender[gender == "Male"]), length(gender[gender == "Female"]), length(gender[gender == "Other"]), length(gender[gender == "Missing"])),
  freq = c(round(length(gender[gender=="Male"])/length(gender), digits=2), round(length(gender[gender=="Female"])/length(gender), digits=2), round(length(gender[gender=="Other"])/length(gender), digits=2), round(length(gender[gender=="Missing"])/length(gender), digits=2))
)

# plot
df %>%
  mutate(gender = fct_reorder(gender, -n)) %>%
           ggplot(aes(gender, n, fill=gender)) + 
           geom_bar(stat="identity", width=0.8) +
           geom_text(aes(label=paste0(freq,"%")), vjust=1.5, colour="white")
```

### Club 3
```{r class.source = 'fold-hide'}
df <- clubdata[[3]] # grab club 

# retrieve node-attribute gender from object
male <- df$male
female <- df$female
other <- df$other

# as factor
gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# make dataframe
df <- data.frame(
  gender = as.factor(c("Male", "Female", "Other", "Missing")),
  n = c(length(gender[gender == "Male"]), length(gender[gender == "Female"]), length(gender[gender == "Other"]), length(gender[gender == "Missing"])),
  freq = c(round(length(gender[gender=="Male"])/length(gender), digits=2), round(length(gender[gender=="Female"])/length(gender), digits=2), round(length(gender[gender=="Other"])/length(gender), digits=2), round(length(gender[gender=="Missing"])/length(gender), digits=2))
)

# plot
df %>%
  mutate(gender = fct_reorder(gender, -n)) %>%
           ggplot(aes(gender, n, fill=gender)) + 
           geom_bar(stat="identity", width=0.8) +
           geom_text(aes(label=paste0(freq,"%")), vjust=1.5, colour="white")
```

### Club 4
```{r class.source = 'fold-hide'}
df <- clubdata[[4]] # grab club 

# retrieve node-attribute gender from object
male <- df$male
female <- df$female
other <- df$other

# as factor
gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# make dataframe
df <- data.frame(
  gender = as.factor(c("Male", "Female", "Other", "Missing")),
  n = c(length(gender[gender == "Male"]), length(gender[gender == "Female"]), length(gender[gender == "Other"]), length(gender[gender == "Missing"])),
  freq = c(round(length(gender[gender=="Male"])/length(gender), digits=2), round(length(gender[gender=="Female"])/length(gender), digits=2), round(length(gender[gender=="Other"])/length(gender), digits=2), round(length(gender[gender=="Missing"])/length(gender), digits=2))
)

# plot
df %>%
  mutate(gender = fct_reorder(gender, -n)) %>%
           ggplot(aes(gender, n, fill=gender)) + 
           geom_bar(stat="identity", width=0.8) +
           geom_text(aes(label=paste0(freq,"%")), vjust=1.5, colour="white")
```

### Club 5
```{r class.source = 'fold-hide'}
df <- clubdata[[5]] # grab club 

# retrieve node-attribute gender from object
male <- df$male
female <- df$female
other <- df$other

# as factor
gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# make dataframe
df <- data.frame(
  gender = as.factor(c("Male", "Female", "Other", "Missing")),
  n = c(length(gender[gender == "Male"]), length(gender[gender == "Female"]), length(gender[gender == "Other"]), length(gender[gender == "Missing"])),
  freq = c(round(length(gender[gender=="Male"])/length(gender), digits=2), round(length(gender[gender=="Female"])/length(gender), digits=2), round(length(gender[gender=="Other"])/length(gender), digits=2), round(length(gender[gender=="Missing"])/length(gender), digits=2))
)

# plot
df %>%
  mutate(gender = fct_reorder(gender, -n)) %>%
           ggplot(aes(gender, n, fill=gender)) + 
           geom_bar(stat="identity", width=0.8) +
           geom_text(aes(label=paste0(freq,"%")), vjust=1.5, colour="white")
```

## {-}

We can see that in all clubs men are overrepresented. 

----

<br>

# Gender segregation

Let's now investigate segregation along gender in the friendship network.


## {.tabset .tabset-fade}

Let's start with describing the total density and intra- (same gender) and intergroup (different gender) densities. We also calculate the Coleman Homophily index for gender, which refelcts gender segregation while taking into account the relative group size of gender categories. We describe these segregation measures for friendship and kudo-networks respectively. 

### Club 1
```{r}
df <- clubdata_rsiena[[1]] # grab club 
df2 <- clubdata[[1]]

fnet <- df$dycCovars$friendship # take friendship network
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# for some reason constructing the dyad-similarity matrix for gender with the rsiena object did not work, so we use the clubdata.RData.
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# construct dyad similarity matrix
gender_m <- fhomomat(gender)


# make object to store results
desmat <- matrix(NA, nrow=4, ncol=2)

# use functions
desmat[1, 1] <- fdensity(fnet)
desmat[2, 1] <- fdensityintra(fnet, gender_m)
desmat[3, 1] <- fdensityinter(fnet, gender_m)
desmat[4, 1] <- fscolnet(fnet, gender)
desmat[1, 2] <- fdensity(knet1)
desmat[2, 2] <- fdensityintra(knet1, gender_m)
desmat[3, 2] <- fdensityinter(knet1, gender_m)
desmat[4, 2] <- fscolnet(knet1, gender)

colnames(desmat) <- c("friendships", "Kudos")
rownames(desmat) <- c("total density", "same gender density", "different gender density", "Coleman's homophily index")



knitr::kable(desmat, digits=2, "html", caption="Gender segregation in friendship and kudo network") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### Club 2
```{r}
df <- clubdata_rsiena[[2]] # grab club 
df2 <- clubdata[[2]]

fnet <- df$dycCovars$friendship # take friendship network
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# for some reason constructing the dyad-similarity matrix for gender with the rsiena object did not work, so we use the clubdata.RData.
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# construct dyad similarity matrix
gender_m <- fhomomat(gender)


# make object to store results
desmat <- matrix(NA, nrow=4, ncol=2)

# use functions
desmat[1, 1] <- fdensity(fnet)
desmat[2, 1] <- fdensityintra(fnet, gender_m)
desmat[3, 1] <- fdensityinter(fnet, gender_m)
desmat[4, 1] <- fscolnet(fnet, gender)
desmat[1, 2] <- fdensity(knet1)
desmat[2, 2] <- fdensityintra(knet1, gender_m)
desmat[3, 2] <- fdensityinter(knet1, gender_m)
desmat[4, 2] <- fscolnet(knet1, gender)

colnames(desmat) <- c("friendships", "Kudos")
rownames(desmat) <- c("total density", "same gender density", "different gender density", "Coleman's homophily index")

# and make a nice table
knitr::kable(desmat, digits=2, "html", caption="Gender segregation in friendship and kudo network") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### Club 3
```{r}
df <- clubdata_rsiena[[3]] # grab club 
df2 <- clubdata[[3]]

fnet <- df$dycCovars$friendship # take friendship network
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# for some reason constructing the dyad-similarity matrix for gender with the rsiena object did not work, so we use the clubdata.RData.
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# construct dyad similarity matrix
gender_m <- fhomomat(gender)


# make object to store results
desmat <- matrix(NA, nrow=4, ncol=2)

# use functions
desmat[1, 1] <- fdensity(fnet)
desmat[2, 1] <- fdensityintra(fnet, gender_m)
desmat[3, 1] <- fdensityinter(fnet, gender_m)
desmat[4, 1] <- fscolnet(fnet, gender)
desmat[1, 2] <- fdensity(knet1)
desmat[2, 2] <- fdensityintra(knet1, gender_m)
desmat[3, 2] <- fdensityinter(knet1, gender_m)
desmat[4, 2] <- fscolnet(knet1, gender)

colnames(desmat) <- c("friendships", "Kudos")
rownames(desmat) <- c("total density", "same gender density", "different gender density", "Coleman's homophily index")

# and make a nice table
knitr::kable(desmat, digits=2, "html", caption="Gender segregation in friendship and kudo network") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### Club 4
```{r}
df <- clubdata_rsiena[[4]] # grab club 
df2 <- clubdata[[4]]

fnet <- df$dycCovars$friendship # take friendship network
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# for some reason constructing the dyad-similarity matrix for gender with the rsiena object did not work, so we use the clubdata.RData.
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# construct dyad similarity matrix
gender_m <- fhomomat(gender)


# make object to store results
desmat <- matrix(NA, nrow=4, ncol=2)

# use functions
desmat[1, 1] <- fdensity(fnet)
desmat[2, 1] <- fdensityintra(fnet, gender_m)
desmat[3, 1] <- fdensityinter(fnet, gender_m)
desmat[4, 1] <- fscolnet(fnet, gender)
desmat[1, 2] <- fdensity(knet1)
desmat[2, 2] <- fdensityintra(knet1, gender_m)
desmat[3, 2] <- fdensityinter(knet1, gender_m)
desmat[4, 2] <- fscolnet(knet1, gender)

colnames(desmat) <- c("friendships", "Kudos")
rownames(desmat) <- c("total density", "same gender density", "different gender density", "Coleman's homophily index")

# and make a nice table
knitr::kable(desmat, digits=2, "html", caption="Gender segregation in friendship and kudo network") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### Club 5
```{r}
df <- clubdata_rsiena[[5]] # grab club 
df2 <- clubdata[[5]]

fnet <- df$dycCovars$friendship # take friendship network
knet <- df$depvars$kudonet # take Kudo network
knet1 <- knet[,,1] # take wave 1 only for now

# for some reason constructing the dyad-similarity matrix for gender with the rsiena object did not work, so we use the clubdata.RData.
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category

# construct dyad similarity matrix
gender_m <- fhomomat(gender)

# make object to store results
desmat <- matrix(NA, nrow=4, ncol=2)

# use functions
desmat[1, 1] <- fdensity(fnet)
desmat[2, 1] <- fdensityintra(fnet, gender_m)
desmat[3, 1] <- fdensityinter(fnet, gender_m)
desmat[4, 1] <- fscolnet(fnet, gender)
desmat[1, 2] <- fdensity(knet1)
desmat[2, 2] <- fdensityintra(knet1, gender_m)
desmat[3, 2] <- fdensityinter(knet1, gender_m)
desmat[4, 2] <- fscolnet(knet1, gender)

colnames(desmat) <- c("friendships", "Kudos")
rownames(desmat) <- c("total density", "same gender density", "different gender density", "Coleman's homophily index")

# and make a nice table
knitr::kable(desmat, digits=2, "html", caption="Gender segregation in friendship and kudo network") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

## {-}

Density in friendships is not much higher within-gender than between-genders, though this ratio differs per club (and in some clubs between-gender friendships are more common). The same pattern holds for Kudo-relationships. 

Coleman's Homophily indices vary across clubs. In some clubs there is slight gender segregation (or same-gender preference) in friendship ties (values higher than 0, but rather close to 0), though in others members tend to befriend others outside their own gender (values lower than 0). Overall, tendencies towards segregation (or avoidance thereof) are pronounced to greater extent in the Kudo-relationships than in the friendships. 

----

<br>

# Behavior

## 1. Running {.tabset .tabset-fade}

We will describe the running activities of the club-members, in terms of times per week (0 - >7) and minutes per month (8 equally populated categories). First, we make a histogram of all (aggregated) observations within clubs over time. Then we will plot the development of the mean over time (with error bars reflecting 95% confidence intervals), seperately for men and women.  

### Club 1
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[1]] # grab club 
df2 <- clubdata[[1]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_run[,,1],
    freq2 = df$depvars$freq_run[,,2],
    freq3 = df$depvars$freq_run[,,3],
    freq4 = df$depvars$freq_run[,,4],
    freq5 = df$depvars$freq_run[,,5],
    freq6 = df$depvars$freq_run[,,6],
    freq7 = df$depvars$freq_run[,,7],
    freq8 = df$depvars$freq_run[,,8],
    freq9 = df$depvars$freq_run[,,9],
    freq10 = df$depvars$freq_run[,,10],
    freq11 = df$depvars$freq_run[,,11],
    freq12 = df$depvars$freq_run[,,12],
    time1 = df$depvars$time_run[,,1],
    time2 = df$depvars$time_run[,,2],
    time3 = df$depvars$time_run[,,3],
    time4 = df$depvars$time_run[,,4],
    time5 = df$depvars$time_run[,,5],
    time6 = df$depvars$time_run[,,6],
    time7 = df$depvars$time_run[,,7],
    time8 = df$depvars$time_run[,,8],
    time9 = df$depvars$time_run[,,9],
    time10 = df$depvars$time_run[,,10],
    time11 = df$depvars$time_run[,,11],
    time12 = df$depvars$time_run[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("run_freq", "run_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_run, main = "Histogram of Running Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_run, main = "Histogram of Running Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 2
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[2]] # grab club 
df2 <- clubdata[[2]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_run[,,1],
    freq2 = df$depvars$freq_run[,,2],
    freq3 = df$depvars$freq_run[,,3],
    freq4 = df$depvars$freq_run[,,4],
    freq5 = df$depvars$freq_run[,,5],
    freq6 = df$depvars$freq_run[,,6],
    freq7 = df$depvars$freq_run[,,7],
    freq8 = df$depvars$freq_run[,,8],
    freq9 = df$depvars$freq_run[,,9],
    freq10 = df$depvars$freq_run[,,10],
    freq11 = df$depvars$freq_run[,,11],
    freq12 = df$depvars$freq_run[,,12],
    time1 = df$depvars$time_run[,,1],
    time2 = df$depvars$time_run[,,2],
    time3 = df$depvars$time_run[,,3],
    time4 = df$depvars$time_run[,,4],
    time5 = df$depvars$time_run[,,5],
    time6 = df$depvars$time_run[,,6],
    time7 = df$depvars$time_run[,,7],
    time8 = df$depvars$time_run[,,8],
    time9 = df$depvars$time_run[,,9],
    time10 = df$depvars$time_run[,,10],
    time11 = df$depvars$time_run[,,11],
    time12 = df$depvars$time_run[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("run_freq", "run_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_run, main = "Histogram of Running Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_run, main = "Histogram of Running Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 3
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[3]] # grab club 
df2 <- clubdata[[3]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_run[,,1],
    freq2 = df$depvars$freq_run[,,2],
    freq3 = df$depvars$freq_run[,,3],
    freq4 = df$depvars$freq_run[,,4],
    freq5 = df$depvars$freq_run[,,5],
    freq6 = df$depvars$freq_run[,,6],
    freq7 = df$depvars$freq_run[,,7],
    freq8 = df$depvars$freq_run[,,8],
    freq9 = df$depvars$freq_run[,,9],
    freq10 = df$depvars$freq_run[,,10],
    freq11 = df$depvars$freq_run[,,11],
    freq12 = df$depvars$freq_run[,,12],
    time1 = df$depvars$time_run[,,1],
    time2 = df$depvars$time_run[,,2],
    time3 = df$depvars$time_run[,,3],
    time4 = df$depvars$time_run[,,4],
    time5 = df$depvars$time_run[,,5],
    time6 = df$depvars$time_run[,,6],
    time7 = df$depvars$time_run[,,7],
    time8 = df$depvars$time_run[,,8],
    time9 = df$depvars$time_run[,,9],
    time10 = df$depvars$time_run[,,10],
    time11 = df$depvars$time_run[,,11],
    time12 = df$depvars$time_run[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("run_freq", "run_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_run, main = "Histogram of Running Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_run, main = "Histogram of Running Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 4
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[4]] # grab club 
df2 <- clubdata[[4]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_run[,,1],
    freq2 = df$depvars$freq_run[,,2],
    freq3 = df$depvars$freq_run[,,3],
    freq4 = df$depvars$freq_run[,,4],
    freq5 = df$depvars$freq_run[,,5],
    freq6 = df$depvars$freq_run[,,6],
    freq7 = df$depvars$freq_run[,,7],
    freq8 = df$depvars$freq_run[,,8],
    freq9 = df$depvars$freq_run[,,9],
    freq10 = df$depvars$freq_run[,,10],
    freq11 = df$depvars$freq_run[,,11],
    freq12 = df$depvars$freq_run[,,12],
    time1 = df$depvars$time_run[,,1],
    time2 = df$depvars$time_run[,,2],
    time3 = df$depvars$time_run[,,3],
    time4 = df$depvars$time_run[,,4],
    time5 = df$depvars$time_run[,,5],
    time6 = df$depvars$time_run[,,6],
    time7 = df$depvars$time_run[,,7],
    time8 = df$depvars$time_run[,,8],
    time9 = df$depvars$time_run[,,9],
    time10 = df$depvars$time_run[,,10],
    time11 = df$depvars$time_run[,,11],
    time12 = df$depvars$time_run[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("run_freq", "run_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_run, main = "Histogram of Running Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_run, main = "Histogram of Running Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 5
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[5]] # grab club 
df2 <- clubdata[[5]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_run[,,1],
    freq2 = df$depvars$freq_run[,,2],
    freq3 = df$depvars$freq_run[,,3],
    freq4 = df$depvars$freq_run[,,4],
    freq5 = df$depvars$freq_run[,,5],
    freq6 = df$depvars$freq_run[,,6],
    freq7 = df$depvars$freq_run[,,7],
    freq8 = df$depvars$freq_run[,,8],
    freq9 = df$depvars$freq_run[,,9],
    freq10 = df$depvars$freq_run[,,10],
    freq11 = df$depvars$freq_run[,,11],
    freq12 = df$depvars$freq_run[,,12],
    time1 = df$depvars$time_run[,,1],
    time2 = df$depvars$time_run[,,2],
    time3 = df$depvars$time_run[,,3],
    time4 = df$depvars$time_run[,,4],
    time5 = df$depvars$time_run[,,5],
    time6 = df$depvars$time_run[,,6],
    time7 = df$depvars$time_run[,,7],
    time8 = df$depvars$time_run[,,8],
    time9 = df$depvars$time_run[,,9],
    time10 = df$depvars$time_run[,,10],
    time11 = df$depvars$time_run[,,11],
    time12 = df$depvars$time_run[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("run_freq", "run_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(run_freq, na.rm=T),
              mean_time = mean(run_time, na.rm=T),
              se_freq = 1.96 * (sd(run_freq, na.rm=T)/sqrt(sum(!is.na(run_freq)))),
              se_time = 1.96 * (sd(run_time, na.rm=T)/sqrt(sum(!is.na(run_time)))),
              sd_freq = sd(run_freq, na.rm=T),
              sd_time = sd(run_time, na.rm=T),
              var_freq = var(run_freq, na.rm = T),
              var_time = var(run_time, na.rm = T),
              kurtosis_freq = kurtosis(run_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(run_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Running volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_run, main = "Histogram of Running Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_run, main = "Histogram of Running Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

## {-}

----

## 2. Other activities {.tabset .tabset-fade}

We will describe other activities as well (e.g., cycling and swimming).

### Club 1
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[1]] # grab club 
df2 <- clubdata[[1]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_other[,,1],
    freq2 = df$depvars$freq_other[,,2],
    freq3 = df$depvars$freq_other[,,3],
    freq4 = df$depvars$freq_other[,,4],
    freq5 = df$depvars$freq_other[,,5],
    freq6 = df$depvars$freq_other[,,6],
    freq7 = df$depvars$freq_other[,,7],
    freq8 = df$depvars$freq_other[,,8],
    freq9 = df$depvars$freq_other[,,9],
    freq10 = df$depvars$freq_other[,,10],
    freq11 = df$depvars$freq_other[,,11],
    freq12 = df$depvars$freq_other[,,12],
    time1 = df$depvars$time_other[,,1],
    time2 = df$depvars$time_other[,,2],
    time3 = df$depvars$time_other[,,3],
    time4 = df$depvars$time_other[,,4],
    time5 = df$depvars$time_other[,,5],
    time6 = df$depvars$time_other[,,6],
    time7 = df$depvars$time_other[,,7],
    time8 = df$depvars$time_other[,,8],
    time9 = df$depvars$time_other[,,9],
    time10 = df$depvars$time_other[,,10],
    time11 = df$depvars$time_other[,,11],
    time12 = df$depvars$time_other[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("other_freq", "other_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_other, main = "Histogram of Other Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_other, main = "Histogram of Other Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 2
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[2]] # grab club 
df2 <- clubdata[[2]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_other[,,1],
    freq2 = df$depvars$freq_other[,,2],
    freq3 = df$depvars$freq_other[,,3],
    freq4 = df$depvars$freq_other[,,4],
    freq5 = df$depvars$freq_other[,,5],
    freq6 = df$depvars$freq_other[,,6],
    freq7 = df$depvars$freq_other[,,7],
    freq8 = df$depvars$freq_other[,,8],
    freq9 = df$depvars$freq_other[,,9],
    freq10 = df$depvars$freq_other[,,10],
    freq11 = df$depvars$freq_other[,,11],
    freq12 = df$depvars$freq_other[,,12],
    time1 = df$depvars$time_other[,,1],
    time2 = df$depvars$time_other[,,2],
    time3 = df$depvars$time_other[,,3],
    time4 = df$depvars$time_other[,,4],
    time5 = df$depvars$time_other[,,5],
    time6 = df$depvars$time_other[,,6],
    time7 = df$depvars$time_other[,,7],
    time8 = df$depvars$time_other[,,8],
    time9 = df$depvars$time_other[,,9],
    time10 = df$depvars$time_other[,,10],
    time11 = df$depvars$time_other[,,11],
    time12 = df$depvars$time_other[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("other_freq", "other_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_other, main = "Histogram of Other Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_other, main = "Histogram of Other Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 3
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[3]] # grab club 
df2 <- clubdata[[3]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_other[,,1],
    freq2 = df$depvars$freq_other[,,2],
    freq3 = df$depvars$freq_other[,,3],
    freq4 = df$depvars$freq_other[,,4],
    freq5 = df$depvars$freq_other[,,5],
    freq6 = df$depvars$freq_other[,,6],
    freq7 = df$depvars$freq_other[,,7],
    freq8 = df$depvars$freq_other[,,8],
    freq9 = df$depvars$freq_other[,,9],
    freq10 = df$depvars$freq_other[,,10],
    freq11 = df$depvars$freq_other[,,11],
    freq12 = df$depvars$freq_other[,,12],
    time1 = df$depvars$time_other[,,1],
    time2 = df$depvars$time_other[,,2],
    time3 = df$depvars$time_other[,,3],
    time4 = df$depvars$time_other[,,4],
    time5 = df$depvars$time_other[,,5],
    time6 = df$depvars$time_other[,,6],
    time7 = df$depvars$time_other[,,7],
    time8 = df$depvars$time_other[,,8],
    time9 = df$depvars$time_other[,,9],
    time10 = df$depvars$time_other[,,10],
    time11 = df$depvars$time_other[,,11],
    time12 = df$depvars$time_other[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("other_freq", "other_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_other, main = "Histogram of Other Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_other, main = "Histogram of Other Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 4
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[4]] # grab club 
df2 <- clubdata[[4]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_other[,,1],
    freq2 = df$depvars$freq_other[,,2],
    freq3 = df$depvars$freq_other[,,3],
    freq4 = df$depvars$freq_other[,,4],
    freq5 = df$depvars$freq_other[,,5],
    freq6 = df$depvars$freq_other[,,6],
    freq7 = df$depvars$freq_other[,,7],
    freq8 = df$depvars$freq_other[,,8],
    freq9 = df$depvars$freq_other[,,9],
    freq10 = df$depvars$freq_other[,,10],
    freq11 = df$depvars$freq_other[,,11],
    freq12 = df$depvars$freq_other[,,12],
    time1 = df$depvars$time_other[,,1],
    time2 = df$depvars$time_other[,,2],
    time3 = df$depvars$time_other[,,3],
    time4 = df$depvars$time_other[,,4],
    time5 = df$depvars$time_other[,,5],
    time6 = df$depvars$time_other[,,6],
    time7 = df$depvars$time_other[,,7],
    time8 = df$depvars$time_other[,,8],
    time9 = df$depvars$time_other[,,9],
    time10 = df$depvars$time_other[,,10],
    time11 = df$depvars$time_other[,,11],
    time12 = df$depvars$time_other[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("other_freq", "other_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_other, main = "Histogram of Other Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_other, main = "Histogram of Other Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

### Club 5
```{r class.source = 'fold-hide'}
df <- clubdata_rsiena[[5]] # grab club 
df2 <- clubdata[[5]]

# development of the mean over time

# retrieve gender
male <- df2$male
female <- df2$female
other <- df2$other

gender <- NA
gender <- ifelse(male == 1, "Male", gender)
gender <- ifelse(female == 1, "Female", gender)
gender <- ifelse(other == 1, "Other", gender)
gender <- ifelse(is.na(gender), "Missing", gender) # missing category


# create wide dataframe
  df2long <- data.frame (
    id = 1:length(df$nodeSets$Actors),
    gender = gender,
    freq1 = df$depvars$freq_other[,,1],
    freq2 = df$depvars$freq_other[,,2],
    freq3 = df$depvars$freq_other[,,3],
    freq4 = df$depvars$freq_other[,,4],
    freq5 = df$depvars$freq_other[,,5],
    freq6 = df$depvars$freq_other[,,6],
    freq7 = df$depvars$freq_other[,,7],
    freq8 = df$depvars$freq_other[,,8],
    freq9 = df$depvars$freq_other[,,9],
    freq10 = df$depvars$freq_other[,,10],
    freq11 = df$depvars$freq_other[,,11],
    freq12 = df$depvars$freq_other[,,12],
    time1 = df$depvars$time_other[,,1],
    time2 = df$depvars$time_other[,,2],
    time3 = df$depvars$time_other[,,3],
    time4 = df$depvars$time_other[,,4],
    time5 = df$depvars$time_other[,,5],
    time6 = df$depvars$time_other[,,6],
    time7 = df$depvars$time_other[,,7],
    time8 = df$depvars$time_other[,,8],
    time9 = df$depvars$time_other[,,9],
    time10 = df$depvars$time_other[,,10],
    time11 = df$depvars$time_other[,,11],
    time12 = df$depvars$time_other[,,12])

# reshape to long dataframe
df_long <- reshape(df2long,
                     direction = "long",
                     varying = c(list(names(df2long)[3:14]),
                                 list(names(df2long)[15:26])),
                     v.names = c("other_freq", "other_time"),
                     idvar = "id",
                     timevar = "time",
                     times = 1:12)

# Reorder data based on user id
df_long  <- df_long [(order(df_long$id)), ]

# create data to plot, seperately for men and women
 data_all <- df_long %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Full Sample"
    )
 
 data_men <- df_long[which(df_long$gender == "Male"), ]
  data_men <- data_men %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Men"
    )
  
  data_women <- df_long[which(df_long$gender == "Female"), ]
  data_women <- data_women %>%
    group_by(time) %>%
    summarise(mean_freq = mean(other_freq, na.rm=T),
              mean_time = mean(other_time, na.rm=T),
              se_freq = 1.96 * (sd(other_freq, na.rm=T)/sqrt(sum(!is.na(other_freq)))),
              se_time = 1.96 * (sd(other_time, na.rm=T)/sqrt(sum(!is.na(other_time)))),
              sd_freq = sd(other_freq, na.rm=T),
              sd_time = sd(other_time, na.rm=T),
              var_freq = var(other_freq, na.rm = T),
              var_time = var(other_time, na.rm = T),
              kurtosis_freq = kurtosis(other_freq, na.rm = T) - 3,
              kurtosis_time = kurtosis(other_time, na.rm = T) - 3,
              class = "Women"
    )

# stack data 
plot.data <- rbind(data_all, data_men, data_women)
rm(data_all, data_men, data_women)

# add months
plot.data$month <- rep(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), 3)

# plot
plot_mean_freq <- ggplot(plot.data, aes(month, mean_freq, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_freq, ymin = mean_freq - se_freq, ymax = mean_freq + se_freq,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other frequency per week", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,5) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )
  
  plot_mean_time <- ggplot(plot.data, aes(month, mean_time, group = class, colour = class)) +
    geom_point() +
    geom_smooth(method = "loess", size=2) +
    geom_errorbar(aes(time, mean_time, ymin = mean_time - se_time, ymax = mean_time + se_time,
                      width = 0.4)) +
    theme_bw(base_family="serif", base_size=16) +
    scale_colour_manual(values=c("#000000", "#E69F00", "#56B4E9")) +
    labs(y = "Other volume per month", x="Month") +
    scale_x_discrete(limits=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
    ylim(0,7) +
    theme(axis.text.x = element_text(family="serif", size = 10, angle = 45, hjust = 1), 
          legend.position = "right", legend.title=element_blank()
    )

### Output ###

# histogram (assuming independent observations)
hist(df$depvars$freq_other, main = "Histogram of Other Frequency", xlab = "Times per week", ylab = "count", col = "grey", border= "black")

hist(df$depvars$time_other, main = "Histogram of Other Volume", xlab = "", ylab = "count", col = "grey", border= "black")

# development mean over time
plot_mean_freq
plot_mean_time
```

## {-}

----

<br>

# Network autocorrelation

## {.tabset .tabset-fade}
We have now covered the sport activity levels of our club-athletes, and the extent to which friendship- and Kudo-associations are segregated along gender. Last, we will explore if friendship- and Kudo-associations are also segregated along activity levels. Or in other words: do people with similar activity levels tend to socialize to a greater extent - by befriending one another and by exchanging Kudos - even when taking into account the opportunity structures for 'interacting' with (dis)similar others? 

We use Moran's I spatial autocorrelation measure for this, which is the correlation between the behavioral score of actor *i* and the (total/mean) behavioral score of alters *j* to whom *i* is connected **directly**. We included the behavioral scores of the actors *h* to whom *i* is indirectly tied, and used the negative exponential function as described by @chen2013 as a distance-decay function for assigning weights.

### Club 1
```{r}
df <- clubdata_rsiena[[1]] # grab club 
df2 <- clubdata[[1]] # grab club 

fnet <- network::as.network(df$dycCovars$friendship) # take friendship network
knet <- df$depvars$kudonet # take kudo network
knet1 <- network::as.network(knet[,,1]) # let's take wave 1

# get behavioral data
freq1 <- df2$freq_run[,,1] # running frequencies wave 1
vol1 <- df2$time_run[,,1] # running volume wave 1

# we include geodistances: shortest path lengths from i to j
f_geodistances <- sna::geodist(fnet, count.paths=T)
f_geodistances <- f_geodistances$gdist 
k_geodistances <- sna::geodist(knet1, count.paths=T)
k_geodistances <- k_geodistances$gdist 

# set the distance 'to yourself' to 'Inf'
diag(f_geodistances) <- Inf
diag(k_geodistances) <- Inf

# and use the negative exponential distance-decay function
f_weights2 <- exp(-f_geodistances)
k_weights2 <- exp(-k_geodistances)

# calculate Moran's I
# we do not row standardize!
f_freq <- fMoran.I(freq1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
f_vol <- fMoran.I(vol1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_freq <- fMoran.I(freq1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_vol <- fMoran.I(vol1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)

# make object to store results
# 1. frequency
mat <- matrix(NA, nrow=2, ncol=4)
mat[1,1] <- f_freq$observed
mat[1,2] <- f_freq$expected
mat[1,3] <- f_freq$sd
mat[1,4] <- f_freq$p.value
mat[2,1] <- k_freq$observed
mat[2,2] <- k_freq$expected
mat[2,3] <- k_freq$sd
mat[2,4] <- k_freq$p.value

# 2. volume
mat2 <- matrix(NA, nrow=2, ncol=4)
mat2[1,1] <- f_vol$observed
mat2[1,2] <- f_vol$expected
mat2[1,3] <- f_vol$sd
mat2[1,4] <- f_vol$p.value
mat2[2,1] <- k_vol$observed
mat2[2,2] <- k_vol$expected
mat2[2,3] <- k_vol$sd
mat2[2,4] <- k_vol$p.value

colnames(mat) <- colnames(mat2) <- c("observed", "expected", "sd", "p-value")
rownames(mat) <- rownames(mat2) <- c("friendship network", "kudo network")

knitr::kable(mat, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and weekly running frequency") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

knitr::kable(mat2, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and monthly running volume") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### Club 2
```{r}
df <- clubdata_rsiena[[2]] # grab club 
df2 <- clubdata[[2]] # grab club 

fnet <- network::as.network(df$dycCovars$friendship) # take friendship network
knet <- df$depvars$kudonet # take kudo network
knet1 <- network::as.network(knet[,,1]) # let's take wave 1

# get behavioral data
freq1 <- df2$freq_run[,,1] # running frequencies wave 1
vol1 <- df2$time_run[,,1] # running volume wave 1

# we include geodistances: shortest path lengths from i to j
f_geodistances <- sna::geodist(fnet, count.paths=T)
f_geodistances <- f_geodistances$gdist 
k_geodistances <- sna::geodist(knet1, count.paths=T)
k_geodistances <- k_geodistances$gdist 

# set the distance 'to yourself' to 'Inf'
diag(f_geodistances) <- Inf
diag(k_geodistances) <- Inf

# and use the negative exponential distance-decay function
f_weights2 <- exp(-f_geodistances)
k_weights2 <- exp(-k_geodistances)

# calculate Moran's I
# we do not row standardize!
f_freq <- fMoran.I(freq1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
f_vol <- fMoran.I(vol1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_freq <- fMoran.I(freq1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_vol <- fMoran.I(vol1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)

# make object to store results
# 1. frequency
mat <- matrix(NA, nrow=2, ncol=4)
mat[1,1] <- f_freq$observed
mat[1,2] <- f_freq$expected
mat[1,3] <- f_freq$sd
mat[1,4] <- f_freq$p.value
mat[2,1] <- k_freq$observed
mat[2,2] <- k_freq$expected
mat[2,3] <- k_freq$sd
mat[2,4] <- k_freq$p.value

# 2. volume
mat2 <- matrix(NA, nrow=2, ncol=4)
mat2[1,1] <- f_vol$observed
mat2[1,2] <- f_vol$expected
mat2[1,3] <- f_vol$sd
mat2[1,4] <- f_vol$p.value
mat2[2,1] <- k_vol$observed
mat2[2,2] <- k_vol$expected
mat2[2,3] <- k_vol$sd
mat2[2,4] <- k_vol$p.value

colnames(mat) <- colnames(mat2) <- c("observed", "expected", "sd", "p-value")
rownames(mat) <- rownames(mat2) <- c("friendship network", "kudo network")

knitr::kable(mat, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and weekly running frequency") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

knitr::kable(mat2, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and monthly running volume") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```


### Club 3
```{r}
df <- clubdata_rsiena[[3]] # grab club 
df2 <- clubdata[[3]] # grab club 

fnet <- network::as.network(df$dycCovars$friendship) # take friendship network
knet <- df$depvars$kudonet # take kudo network
knet1 <- network::as.network(knet[,,1]) # let's take wave 1

# get behavioral data
freq1 <- df2$freq_run[,,1] # running frequencies wave 1
vol1 <- df2$time_run[,,1] # running volume wave 1

# we include geodistances: shortest path lengths from i to j
f_geodistances <- sna::geodist(fnet, count.paths=T)
f_geodistances <- f_geodistances$gdist 
k_geodistances <- sna::geodist(knet1, count.paths=T)
k_geodistances <- k_geodistances$gdist 

# set the distance 'to yourself' to 'Inf'
diag(f_geodistances) <- Inf
diag(k_geodistances) <- Inf

# and use the negative exponential distance-decay function
f_weights2 <- exp(-f_geodistances)
k_weights2 <- exp(-k_geodistances)

# calculate Moran's I
# we do not row standardize!
f_freq <- fMoran.I(freq1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
f_vol <- fMoran.I(vol1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_freq <- fMoran.I(freq1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_vol <- fMoran.I(vol1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)

# make object to store results
# 1. frequency
mat <- matrix(NA, nrow=2, ncol=4)
mat[1,1] <- f_freq$observed
mat[1,2] <- f_freq$expected
mat[1,3] <- f_freq$sd
mat[1,4] <- f_freq$p.value
mat[2,1] <- k_freq$observed
mat[2,2] <- k_freq$expected
mat[2,3] <- k_freq$sd
mat[2,4] <- k_freq$p.value

# 2. volume
mat2 <- matrix(NA, nrow=2, ncol=4)
mat2[1,1] <- f_vol$observed
mat2[1,2] <- f_vol$expected
mat2[1,3] <- f_vol$sd
mat2[1,4] <- f_vol$p.value
mat2[2,1] <- k_vol$observed
mat2[2,2] <- k_vol$expected
mat2[2,3] <- k_vol$sd
mat2[2,4] <- k_vol$p.value

colnames(mat) <- colnames(mat2) <- c("observed", "expected", "sd", "p-value")
rownames(mat) <- rownames(mat2) <- c("friendship network", "kudo network")

knitr::kable(mat, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and weekly running frequency") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

knitr::kable(mat2, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and monthly running volume") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```


### Club 4
```{r}
df <- clubdata_rsiena[[4]] # grab club 
df2 <- clubdata[[4]] # grab club 

fnet <- network::as.network(df$dycCovars$friendship) # take friendship network
knet <- df$depvars$kudonet # take kudo network
knet1 <- network::as.network(knet[,,1]) # let's take wave 1

# get behavioral data
freq1 <- df2$freq_run[,,1] # running frequencies wave 1
vol1 <- df2$time_run[,,1] # running volume wave 1

# we include geodistances: shortest path lengths from i to j
f_geodistances <- sna::geodist(fnet, count.paths=T)
f_geodistances <- f_geodistances$gdist 
k_geodistances <- sna::geodist(knet1, count.paths=T)
k_geodistances <- k_geodistances$gdist 

# set the distance 'to yourself' to 'Inf'
diag(f_geodistances) <- Inf
diag(k_geodistances) <- Inf

# and use the negative exponential distance-decay function
f_weights2 <- exp(-f_geodistances)
k_weights2 <- exp(-k_geodistances)

# calculate Moran's I
# we do not row standardize!
f_freq <- fMoran.I(freq1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
f_vol <- fMoran.I(vol1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_freq <- fMoran.I(freq1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_vol <- fMoran.I(vol1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)

# make object to store results
# 1. frequency
mat <- matrix(NA, nrow=2, ncol=4)
mat[1,1] <- f_freq$observed
mat[1,2] <- f_freq$expected
mat[1,3] <- f_freq$sd
mat[1,4] <- f_freq$p.value
mat[2,1] <- k_freq$observed
mat[2,2] <- k_freq$expected
mat[2,3] <- k_freq$sd
mat[2,4] <- k_freq$p.value

# 2. volume
mat2 <- matrix(NA, nrow=2, ncol=4)
mat2[1,1] <- f_vol$observed
mat2[1,2] <- f_vol$expected
mat2[1,3] <- f_vol$sd
mat2[1,4] <- f_vol$p.value
mat2[2,1] <- k_vol$observed
mat2[2,2] <- k_vol$expected
mat2[2,3] <- k_vol$sd
mat2[2,4] <- k_vol$p.value

colnames(mat) <- colnames(mat2) <- c("observed", "expected", "sd", "p-value")
rownames(mat) <- rownames(mat2) <- c("friendship network", "kudo network")

knitr::kable(mat, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and weekly running frequency") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

knitr::kable(mat2, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and monthly running volume") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### Club 5
```{r}
df <- clubdata_rsiena[[5]] # grab club 
df2 <- clubdata[[5]] # grab club 

fnet <- network::as.network(df$dycCovars$friendship) # take friendship network
knet <- df$depvars$kudonet # take kudo network
knet1 <- network::as.network(knet[,,1]) # let's take wave 1

# get behavioral data
freq1 <- df2$freq_run[,,1] # running frequencies wave 1
vol1 <- df2$time_run[,,1] # running volume wave 1

# we include geodistances: shortest path lengths from i to j
f_geodistances <- sna::geodist(fnet, count.paths=T)
f_geodistances <- f_geodistances$gdist 
k_geodistances <- sna::geodist(knet1, count.paths=T)
k_geodistances <- k_geodistances$gdist 

# set the distance 'to yourself' to 'Inf'
diag(f_geodistances) <- Inf
diag(k_geodistances) <- Inf

# and use the negative exponential distance-decay function
f_weights2 <- exp(-f_geodistances)
k_weights2 <- exp(-k_geodistances)

# calculate Moran's I
# we do not row standardize!
f_freq <- fMoran.I(freq1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
f_vol <- fMoran.I(vol1, scaled = FALSE, weight = f_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_freq <- fMoran.I(freq1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)
k_vol <- fMoran.I(vol1, scaled = FALSE, weight = k_weights2, na.rm = TRUE, rowstandardize = FALSE)

# make object to store results
# 1. frequency
mat <- matrix(NA, nrow=2, ncol=4)
mat[1,1] <- f_freq$observed
mat[1,2] <- f_freq$expected
mat[1,3] <- f_freq$sd
mat[1,4] <- f_freq$p.value
mat[2,1] <- k_freq$observed
mat[2,2] <- k_freq$expected
mat[2,3] <- k_freq$sd
mat[2,4] <- k_freq$p.value

# 2. volume
mat2 <- matrix(NA, nrow=2, ncol=4)
mat2[1,1] <- f_vol$observed
mat2[1,2] <- f_vol$expected
mat2[1,3] <- f_vol$sd
mat2[1,4] <- f_vol$p.value
mat2[2,1] <- k_vol$observed
mat2[2,2] <- k_vol$expected
mat2[2,3] <- k_vol$sd
mat2[2,4] <- k_vol$p.value

colnames(mat) <- colnames(mat2) <- c("observed", "expected", "sd", "p-value")
rownames(mat) <- rownames(mat2) <- c("friendship network", "kudo network")

knitr::kable(mat, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and weekly running frequency") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

knitr::kable(mat2, digits=2, "html", caption="Moran's I statistic for spatial autocorrelation based on geodistances and monthly running volume") %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

## {-}

Here, the Moran's I statistic tests whether club members that are *closer to one another* (i.e., having a shorter geodesic/path length), are more a similar with respect to their behavior, under the null hypothesis that behavior is 'randomly distributed' among the club members.

We observe that, indeed, friends that are closer to one another are more alike, and especially "strong tie" friends (indicated by the strongly significant Moran's I statistics on the Kudo networks). Additional analyses (not shown here) revealed that autocorrelation was even stronger without the distance-decay function, which suggests that especially close alters (with path length one) are similar. 

----

<br>

## References
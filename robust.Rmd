---
title: "Different kudos-tie cut-off"
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
bibliography: references.bib
output:
  html_document:
    css: tweaks.css
    number_sections: false
    toc_depth: 1
    code_folding: show
    code_download: yes
---

```{r, globalsettings, echo=FALSE, warning=FALSE}
library(knitr)
library(RSiena)
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()

colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }

```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

<br>

# Different kudos-tie classification

---

In our main analyses, a kudos-tie $X_{ij}^{(h)} = 1$ if actor *i* gave $\ge 1$ kudos to actor *j*; otherwise 0.

We increased the number of kudos required for $X_{ij}^{(h)} = 1$. We inspect how this would affect the network properties of the resulting model - we use the 'print01Report'-function to check densities, average degrees and Jaccard indices.

We do this for club 2. In this network we found a positive indegree effect on frequency, and in this network, kudos-ties were relatively stable (average Jaccard index over periods = 0.75; see below).

<!--- 

Perhaps also perform this robustness check for club 1 (?): here we did not find an indegree effect. would  be interesting to see if another kudos-tie operatinalization yields different results. 

---> 




```{r eval=F, class.source = 'fold-hide'}
load("clubdata_rsiena.Rdata")
mydata <- clubdata_rsiena[[2]] # grab club
#print01Report(mydata, modelname="files/robustness/test")
```

![](files/robustness/test.txt){#id .class width=100% height=200px}

<br>

First, we inspect an altered kudos-network operationalization where $X_{ij}^{(h)} = 1$ if actor *i* gave$\ > 1$ kudos to actor *j*; otherwise 0.

We present a part of the print01Report-output below. Network properties change only slightly...

```{r eval=F, class.source = 'fold-hide'}
load("clubdata_rsiena2.Rdata")
mydata <- clubdata_rsiena2[[2]] # grab club
#print01Report(mydata, modelname="files/robustness/test1")
```

![](files/robustness/test1.txt){#id .class width=100% height=200px}

<br>


Second, a kudos-network operationalization where $X_{ij}^{(h)} = 1$ if actor *i* gave$\ > 2$ kudos to actor *j*; otherwise 0, was inspected

```{r eval=F, class.source = 'fold-hide'}
load("clubdata_rsiena3.Rdata")
mydata <- clubdata_rsiena3[[2]] # grab club
#print01Report(mydata, modelname="files/robustness/test2")
```

![](files/robustness/test2.txt){#id .class width=100% height=200px}

Again, only a slight change in network stability. But overall, the average degree has decreased to a greater extent. Let's use this as our operationalization, and let's investigate how this impacts our findings. We use the same model as we did in our main analyses.

```{r eval=F, class.source = 'fold-hide'}
myeff <- getEffects(mydata) # define myeff object
#effectsDocumentation()

# model structure
myeff <- includeEffects(myeff, gwespFF, name = "kudonet3") 
myeff <- includeEffects(myeff, outActSqrt, inPopSqrt, name = "kudonet3") 
myeff <- includeEffects( myeff, outIso, name = "kudonet3")
myeff <- includeInteraction(myeff, recip, gwespFF, parameter = 69, name = "kudonet3")
myeff <- includeEffects(myeff, reciAct, name = "kudonet3")
myeff <- setEffect(myeff, higher, name = "kudonet3", interaction1 = "freq_run")
myeff <- includeEffects(myeff, egoX, altX, sameX, name="kudonet3", interaction1 = "gender" )

# selection effects
myeff <- includeEffects(myeff, effFrom, name = "time_run", interaction1 = "freq_run")
myeff <- includeEffects(myeff, effFrom, name = "freq_run", interaction1 = "time_run")
myeff <- includeEffects(myeff, effFrom, name = "time_run", interaction1 = "time_other")
myeff <- includeEffects(myeff, effFrom, name = "freq_run", interaction1 = "freq_other")

# indegree --> running
myeff <- includeEffects(myeff, indeg, name = "freq_run", interaction1 = "kudonet3") 
myeff <- includeEffects(myeff, indeg, name = "time_run", interaction1 = "kudonet3")

# define algorithm
myalgorithm <- sienaAlgorithmCreate(projname = "test")

# estimate the SAOM
ans <- siena07(myalgorithm, data = mydata, effects = myeff,
                 batch = FALSE, verbose = FALSE, returnDeps = TRUE)
# the following script lets the model re-run until we get a good convergence ratio
while (TRUE){
  
  if(ans$tconv.max >= .25){
    try <- try + 1
    print(paste("Model did not converge: ", ans$tconv.max, sep = ""))
    print(paste("Try:", try, sep=" "))
    ans <- siena07( myalgorithm, data = mydata, effects = myeff, prevAns= ans, returnDeps=TRUE)
    
  }else{
    siena.table(ans, type="html", tstat=T, d=3, sig=T, file = paste("files", "/", "robustness", "/", "3kudoModel", ".html", sep=""))
    print(paste("Reached convergence ratio of ", ans$tconv.max, sep = ""))
    break
  }
}


```


